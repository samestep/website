<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/monokai.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"
    />
    <link rel="stylesheet" href="/blog.css" />
    <link rel="stylesheet" href="style.css" />
    <title>How can computers roll dice? | Sam Estep</title>
  </head>
  <body>
    <main>
      <h1>How can computers roll dice?</h1>
      <p>
        <em>by <a href="/">Sam Estep</a>, 2024-10-20</em>
      </p>
      <div>
        <p>
          If you
          <a href="https://www.google.com/search?q=roll+a+die"
            >type &quot;roll a die&quot; into Google</a
          >, it... well, it rolls a die:
        </p>
        <p><img src="die.png" alt='Google "roll a die"' /></p>
        <p>But how does it do that?</p>
        <p>
          To start: you may have heard that computers use binary numbers. That's
          true! This has been well-explained by many other people, so if you're
          unfamiliar, check out one of those explanations, e.g.
          <a href="https://youtu.be/sXxwr66Y79Y">Khan Academy</a>.
        </p>
        <p>
          <em>(6 minutes later)</em> Welcome back! So yeah, every digit of every
          number in your computer is either a 0 or a 1. Kind of like when you
          flip a coin, it's either heads or tails. (<a
            href="https://imois.in/posts/3-sided-coin/"
            >Or edge</a
          >, but that's a different post entirely.) Let's talk about coin flips,
          then!
        </p>
        <h2>Coin flips</h2>
        <p>
          You can also
          <a href="https://www.google.com/search?q=flip+a+coin"
            >Google &quot;flip a coin&quot;</a
          >:
        </p>
        <p><img src="coin.png" alt='Google "flip a coin"' /></p>
        <p>
          This is much closer to the computer's native tongue. All it has to do
          is generate a single random bit. For the remainder of this post, we're
          going to take &quot;generate a random bit&quot; (or equivalently,
          &quot;flip a coin&quot;) as a basic primitive, and then build
          everything else on top of that.
        </p>
        <p>
          Let's say we want to simulate a die roll but all we have is a coin to
          flip. How can we give each number on the die an equal chance? Well, we
          can start by flipping the coin once. This at least lets us narrow down
          the possibilities:
        </p>
        <ul>
          <li>
            If we got <strong>heads</strong>, we'll say that the die roll is
            even: <strong>2</strong>, <strong>4</strong>, or <strong>6</strong>.
          </li>
          <li>
            If we got <strong>tails</strong>, we'll say that the die roll is
            odd: <strong>1</strong>, <strong>3</strong>, or <strong>5</strong>.
          </li>
        </ul>
        <p>
          Either way we have 3 possibilities left. Now we're kinda stuck. If we
          flip the coin again, how do we choose what to do? Let's say our first
          flip was heads, so our choices are <strong>2</strong>,
          <strong>4</strong>, or <strong>6</strong>. We could say:
        </p>
        <ul>
          <li>
            If we get <strong>heads</strong> again, we'll say the die roll is
            <strong>2</strong>.
          </li>
          <li>
            If we get <strong>tails</strong>, we'll say the die roll is
            <strong>4</strong> or <strong>6</strong>.
          </li>
        </ul>
        <p>
          And then if we got tails, we need to flip a third time to choose
          between <strong>4</strong> and <strong>6</strong>. But this is
          <em>not</em> a fair die roll! We're twice as likely to get
          <strong>2</strong> as we are to get <strong>4</strong>, and similarly
          we're twice as likely to get <strong>2</strong> as <strong>6</strong>.
          What are we to do?
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 200" height="200">
            <rect
              x="50"
              y="38.33333333333333"
              width="32.5"
              height="141.66666666666669"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="92.5"
              y="38.33333333333333"
              width="32.5"
              height="141.66666666666669"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="135"
              y="109.16666666666666"
              width="32.5"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="177.5"
              y="109.16666666666666"
              width="32.5"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="220"
              y="109.16666666666666"
              width="32.5"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="262.5"
              y="109.16666666666666"
              width="32.5"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <text
              x="40"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              30%
            </text>
            <text
              x="40"
              y="180"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0%
            </text>
            <text
              x="66.25"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              1
            </text>
            <text
              x="108.75"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              2
            </text>
            <text
              x="151.25"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              3
            </text>
            <text
              x="193.75"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="236.25"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              5
            </text>
            <text
              x="278.75"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              6
            </text>
            <polyline
              points="45,10 45,180 300,180"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <h2>Python!</h2>
        <p>
          Let's look at how real computers do it. If you have
          <a href="https://www.python.org/">the snake language</a> installed,
          it's pretty straightforward to use the
          <a href="https://docs.python.org/3/library/random.html"
            >builtin <code>random</code> module</a
          >
          to simulate rolling a die:
        </p>
        <pre><code>$ python
&gt;&gt;&gt; import random
&gt;&gt;&gt; random.randint(1, 6)
5
&gt;&gt;&gt; random.randint(1, 6)
2
</code></pre>
        <p>
          Now, you and I may have different ideas of fun, but I always enjoy
          doing a little deep dive of the source code for other people's
          software that I'm running.
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L925"
            >How is <code>randint</code> defined?</a
          >
        </p>
        <pre><code class="language-python">randint = _inst.randint
</code></pre>
        <p>
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L920"
            >Alright.</a
          >
        </p>
        <pre><code class="language-python">_inst = Random()
</code></pre>
        <p>
          So
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L332-L336"
            >that means:</a
          >
        </p>
        <pre><code class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">randint</span>(<span class="hljs-params">self, a, b</span>):
    <span class="hljs-string">&quot;&quot;&quot;Return random integer in range [a, b], including both end points.
    &quot;&quot;&quot;</span>

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.randrange(a, b+<span class="hljs-number">1</span>)
</code></pre>
        <p>
          Fair enough: to generate a random integer between 1 and 6 (inclusive),
          that's the same as generating a random integer between 1 (inclusive)
          and 7 (exclusive). If you look at the
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L291-L330"
            >source for <code>randrange</code></a
          >, there are three different cases; we're only interested in one of
          them, so I'll simplify the source code as if that were the only case:
        </p>
        <pre><code class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">randrange</span>(<span class="hljs-params">self, start, stop</span>):
    <span class="hljs-string">&quot;&quot;&quot;Choose a random item from range(start, stop).
    &quot;&quot;&quot;</span>

    istart = _index(start)
    istop = _index(stop)
    width = istop - istart
    istep = _index(step)
        <span class="hljs-keyword">if</span> width &gt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> istart + <span class="hljs-variable language_">self</span>._randbelow(width)
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;empty range in randrange(<span class="hljs-subst">{start}</span>, <span class="hljs-subst">{stop}</span>)&quot;</span>)
</code></pre>
        <p>
          So to generate a random integer between 1 (inclusive) and 7
          (exclusive), that's the same as generating a random integer between 0
          (inclusive) and 6 (exclusive) and then adding 1 at the end; but the
          rabbit hole gets deeper.
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L271"
            >What is <code>_randbelow</code>?</a
          >
        </p>
        <pre><code class="language-python">_randbelow = _randbelow_with_getrandbits
</code></pre>
        <p>
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L242-L250"
            >OK.</a
          >
        </p>
        <pre><code class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_randbelow_with_getrandbits</span>(<span class="hljs-params">self, n</span>):
    <span class="hljs-string">&quot;Return a random int in the range [0,n).  Defined for n &gt; 0.&quot;</span>

    getrandbits = <span class="hljs-variable language_">self</span>.getrandbits
    k = n.bit_length()
    r = getrandbits(k)  <span class="hljs-comment"># 0 &lt;= r &lt; 2**k</span>
    <span class="hljs-keyword">while</span> r &gt;= n:
        r = getrandbits(k)
    <span class="hljs-keyword">return</span> r
</code></pre>
        <p>
          Now that's what I'm talkin' about! See how it's defined entirely in
          terms of
          <a
            href="https://github.com/python/cpython/blob/v3.12.7/Lib/random.py#L889-L895"
            ><code>getrandbits</code></a
          >? Like we said before, in the end it all goes back to coin flips.
          First we call
          <a
            href="https://docs.python.org/3/library/stdtypes.html#int.bit_length"
            ><code>bit_length</code></a
          >
          on <code>n</code>, which works like this:
        </p>
        <pre><code>&gt;&gt;&gt; n = 6
&gt;&gt;&gt; bin(n)
'0b110'
&gt;&gt;&gt; n.bit_length()
3
</code></pre>
        <p>
          So Python looks at the upper limit for the range of integers we care
          about, and asks: how many bits do I need to represent that integer? In
          the case of rolling a die, the answer is three bits, or three coin
          flips. So far, nothing is different from what we did before, because
          if you recall, in the worst case we did need to flip our coin three
          times. But here instead of deciding what to do after each coin flip,
          we simply flip the coin three times right at the start. This gives a
          <em>uniform</em> random three-bit integer. The smallest integer we can
          represent with three bits is 0, and the largest is 7. And indeed, if
          you run <code>random.getrandbits(3)</code> many times, you'll see this
          uniform distribution!
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 200" height="200">
            <rect
              x="50"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="81.875"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="113.75"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="145.625"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="177.5"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="209.375"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="241.25"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="273.125"
              y="109.16666666666666"
              width="21.875"
              height="70.83333333333334"
              fill="hsl(222 100% 75%)"
            ></rect>
            <text
              x="40"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              30%
            </text>
            <text
              x="40"
              y="180"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0%
            </text>
            <text
              x="60.9375"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              0
            </text>
            <text
              x="92.8125"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              1
            </text>
            <text
              x="124.6875"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              2
            </text>
            <text
              x="156.5625"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              3
            </text>
            <text
              x="188.4375"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="220.3125"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              5
            </text>
            <text
              x="252.1875"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              6
            </text>
            <text
              x="284.0625"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              7
            </text>
            <polyline
              points="45,10 45,180 300,180"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          OK... but that's not what we actually want. We wanted the generated
          integer to be less than 6, so we can add 1 to it and get a uniform die
          roll. And that's where the <code>while</code> loop comes in: if the
          generated integer is 6 or 7, we completely ignore it, flip the coin
          three more times, and try again. We just keep doing this until we get
          something in the correct range. In general this technique is called
          <a href="https://en.wikipedia.org/wiki/Rejection_sampling"
            >rejection sampling</a
          >. As we said before, we can do this until it works, then add 1.
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 200" height="200">
            <rect
              x="50"
              y="85.55555555555556"
              width="32.5"
              height="94.44444444444444"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="92.5"
              y="85.55555555555556"
              width="32.5"
              height="94.44444444444444"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="135"
              y="85.55555555555556"
              width="32.5"
              height="94.44444444444444"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="177.5"
              y="85.55555555555556"
              width="32.5"
              height="94.44444444444444"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="220"
              y="85.55555555555556"
              width="32.5"
              height="94.44444444444444"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="262.5"
              y="85.55555555555556"
              width="32.5"
              height="94.44444444444444"
              fill="hsl(222 100% 75%)"
            ></rect>
            <text
              x="40"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              30%
            </text>
            <text
              x="40"
              y="180"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0%
            </text>
            <text
              x="66.25"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              1
            </text>
            <text
              x="108.75"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              2
            </text>
            <text
              x="151.25"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              3
            </text>
            <text
              x="193.75"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="236.25"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              5
            </text>
            <text
              x="278.75"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              6
            </text>
            <polyline
              points="45,10 45,180 300,180"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          And really, this works fine. If all you wanted to know is how your
          computer rolls a die then congratulations, now you know! But... isn't
          this a bit inefficient? Well, we can plot the chance that
        </p>
        <ul>
          <li>we don't have to retry at all,</li>
          <li>we have to retry only once,</li>
          <li>we have to retry twice,</li>
          <li>etc.,</li>
        </ul>
        <p>and draw those in a different kind of histogram.</p>
        <div class="svg">
          <svg viewBox="0 0 300 225" height="225">
            <rect
              x="50"
              y="180"
              width="18.333333333333332"
              height="0"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="78.33333333333333"
              y="180"
              width="18.333333333333332"
              height="0"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="106.66666666666666"
              y="52.5"
              width="18.333333333333332"
              height="127.5"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="135"
              y="180"
              width="18.333333333333332"
              height="0"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="163.33333333333331"
              y="180"
              width="18.333333333333332"
              height="0"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="191.66666666666666"
              y="148.125"
              width="18.333333333333332"
              height="31.875"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="220"
              y="180"
              width="18.333333333333332"
              height="0"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="248.33333333333331"
              y="180"
              width="18.333333333333332"
              height="0"
              fill="hsl(222 100% 75%)"
            ></rect>
            <rect
              x="276.66666666666663"
              y="172.03125"
              width="18.333333333333332"
              height="7.96875"
              fill="hsl(222 100% 75%)"
            ></rect>
            <text
              x="40"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              100%
            </text>
            <text
              x="40"
              y="180"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0%
            </text>
            <text
              x="59.166666666666664"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              1
            </text>
            <text
              x="87.5"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              2
            </text>
            <text
              x="115.83333333333333"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              3
            </text>
            <text
              x="144.16666666666666"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="172.49999999999997"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              5
            </text>
            <text
              x="200.83333333333331"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              6
            </text>
            <text
              x="229.16666666666666"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              7
            </text>
            <text
              x="257.5"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="285.8333333333333"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              9
            </text>
            <text
              x="172.5"
              y="220"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              number of coin flips
            </text>
            <polyline
              points="45,10 45,180 300,180"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          This shows that it's not <em>horrible</em>: the chance of having to
          retry
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          times is exponential in
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >. Actually, how well should we <em>expect</em> to be able to do?
          Well, in the case where
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          is a power of two, uniformly sampling a nonnegative integer less than
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          is equivalent to flipping a coin
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow
                    ><msub><mi>log</mi><mn>2</mn></msub
                    ><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\log_2 n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.69444em"></span
              ><span
                class="strut bottom"
                style="height: 0.9388799999999999em; vertical-align: -0.24444em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mop"
                  ><span class="mop"
                    >lo<span style="margin-right: 0.01389em">g</span></span
                  ><span class="vlist"
                    ><span style="top: 0.24444em; margin-right: 0.05em"
                      ><span class="fontsize-ensurer reset-size5 size5"
                        ><span style="font-size: 0em">​</span></span
                      ><span class="reset-textstyle scriptstyle cramped"
                        ><span class="mord mathrm">2</span></span
                      ></span
                    ><span class="baseline-fix"
                      ><span class="fontsize-ensurer reset-size5 size5"
                        ><span style="font-size: 0em">​</span></span
                      >​</span
                    ></span
                  ></span
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          times; no need to retry. If
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          is not a power of two then instead of directly giving the number of
          coin flips, that logarithm gives the
          <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)"
            >entropy</a
          >
          of the distribution; if we're using random bits to faithfully sampling
          from the distribution, we can't do better than the entropy on average.
          So for varying values of
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          on the
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>x</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >x</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">x</span></span
              ></span
            ></span
          >-axis, we can plot the entropy (in <span class="blue">blue</span>)
          and Python's expected number of coin flips (in
          <span class="red">red</span>) on the
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>y</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >y</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.625em; vertical-align: -0.19444em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit" style="margin-right: 0.03588em"
                  >y</span
                ></span
              ></span
            ></span
          >-axis.
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 200" height="200">
            <polyline
              points="27.6,180 30.2,168.66666666666666 32.8,162.03709165849358 35.4,157.33333333333334 38,153.6848149246099 40.6,150.70375832516024 43.2,148.18331088334716 45.8,146 48.4,144.07418331698713 51,142.35148159127655 53.6,140.79310832211064 56.2,139.3704249918269 58.800000000000004,138.06168319440096 61.400000000000006,136.84997755001382 64,135.72190658310345 66.6,134.66666666666666 69.2,133.67542113249615 71.8,132.7408499836538 74.4,131.85682151430603 77,131.0181482579432 79.6,130.2204025418407 82.2,129.4597749887773 84.80000000000001,128.73296449802052 87.4,128.03709165849358 90,127.36962984921979 92.60000000000001,126.72834986106763 95.2,126.1112749754807 97.80000000000001,125.51664421668049 100.39999999999999,124.94288205522085 103,124.38857324977012 105.6,123.8524418156154 108.2,123.33333333333334 110.8,122.83019998060419 113.4,122.34208779916281 116,121.86812580795706 118.6,121.40751665032047 121.2,120.95952852287189 123.8,120.52348818097269 126.4,120.09877485289451 129,119.6848149246099 131.6,119.28107728099505 134.2,118.88706920850737 136.8,118.50233278004289 139.4,118.12644165544395 142,117.75899824159703 144.60000000000002,117.39963116468718 147.2,117.04799301432011 149.8,116.70375832516024 152.39999999999998,116.36662176669431 155,116.03629651588645 157.6,115.71251279098972 160.20000000000002,115.39501652773428 162.8,115.08356818161708 165.4,114.77794164214735 168,114.47792324672052 170.60000000000002,114.18331088334716 173.2,113.8939131727996 175.79999999999998,113.60954872188752 178.4,113.3300454405658 181,113.05523991643679 183.6,112.78497684095395 186.2,112.51910848228208 188.8,112.25749420033428 191.4,112 194,111.74649811901085 196.6,111.49686664727086 199.20000000000002,111.2509891748119 201.8,111.00875446582948 204.39999999999998,110.77005615651409 207,110.53479247462371 209.6,110.30286597894693 212.2,110.07418331698713 214.79999999999998,109.8486549993598 217.4,109.62619518953856 220,109.40672150771336 222.6,109.19015484763938 225.20000000000002,108.97641920545779 227.8,108.76544151956118 230.4,108.5571515206595 233,108.35148159127655 235.60000000000002,108.14836663397426 238.2,107.94774394766172 240.79999999999998,107.74955311140153 243.4,107.55373587517404 246,107.36023605710605 248.6,107.16899944670956 251.2,106.97997371371441 253.8,106.79310832211063 256.4,106.6083544490475 259,106.42566490826368 261.6,106.24499407774812 264.20000000000005,106.06629783135385 266.8,105.88953347410899 269.4,105.71465968098677 272,105.54163643891593 274.6,105.3704249918269 277.2,105.20098778854589 279.79999999999995,105.03328843336097 282.4,104.86729163909776 285,104.70296318255312"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="27.6,157.33333333333334 30.2,134.66666666666666 32.8,149.77777777777777 35.4,112 38,125.6 40.6,134.66666666666666 43.2,141.14285714285714 45.8,89.33333333333333 48.4,99.40740740740742 51,107.46666666666667 53.6,114.06060606060606 56.2,119.55555555555557 58.800000000000004,124.2051282051282 61.400000000000006,128.1904761904762 64,131.64444444444445 66.6,66.66666666666667 69.2,73.33333333333333 71.8,79.25925925925925 74.4,84.56140350877193 77,89.33333333333333 79.6,93.65079365079366 82.2,97.57575757575758 84.80000000000001,101.15942028985508 87.4,104.44444444444444 90,107.46666666666667 92.60000000000001,110.25641025641025 95.2,112.8395061728395 97.80000000000001,115.23809523809523 100.39999999999999,117.47126436781608 103,119.55555555555557 105.6,121.50537634408602 108.2,44 110.8,48.121212121212125 113.4,51.99999999999997 116,55.65714285714286 118.6,59.11111111111113 121.2,62.37837837837837 123.8,65.47368421052632 126.4,68.41025641025641 129,71.2 131.6,73.85365853658537 134.2,76.3809523809524 136.8,78.79069767441861 139.4,81.0909090909091 142,83.28888888888889 144.60000000000002,85.39130434782608 147.2,87.40425531914893 149.8,89.33333333333333 152.39999999999998,91.18367346938777 155,92.96 157.6,94.66666666666667 160.20000000000002,96.3076923076923 162.8,97.88679245283019 165.4,99.40740740740742 168,100.87272727272727 170.60000000000002,102.28571428571429 173.2,103.64912280701755 175.79999999999998,104.96551724137932 178.4,106.23728813559322 181,107.46666666666667 183.6,108.65573770491804 186.2,109.80645161290323 188.8,110.92063492063492 191.4,21.333333333333343 194,23.77435897435896 196.6,26.141414141414145 199.20000000000002,28.43781094527364 201.8,30.666666666666657 204.39999999999998,32.830917874396135 207,34.93333333333334 209.6,36.976525821596255 212.2,38.96296296296296 214.79999999999998,40.894977168949794 217.4,42.774774774774755 220,44.604444444444425 222.6,46.38596491228071 225.20000000000002,48.121212121212125 227.8,49.81196581196579 230.4,51.45991561181435 233,53.06666666666668 235.60000000000002,54.633744855967095 238.2,56.162601626016254 240.79999999999998,57.654618473895596 243.4,59.11111111111113 246,60.53333333333333 248.6,61.92248062015503 251.2,63.27969348659005 253.8,64.6060606060606 256.4,65.90262172284645 259,67.17037037037038 261.6,68.41025641025641 264.20000000000005,69.6231884057971 266.8,70.81003584229391 269.4,71.97163120567377 272,73.10877192982457 274.6,74.22222222222221 277.2,75.31271477663232 279.79999999999995,76.3809523809524 282.4,77.42760942760944 285,78.45333333333332"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="20"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              15
            </text>
            <text
              x="20"
              y="180"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0
            </text>
            <text
              x="77"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="129"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              40
            </text>
            <text
              x="181"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              60
            </text>
            <text
              x="233"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              80
            </text>
            <text
              x="285"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              100
            </text>
            <polyline
              points="25,10 25,180 285,180"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          For some integers, Python will on average sample roughly the
          theoretical minimum possible number of bits. But for others, it
          samples twice as many bits as should be needed!
        </p>
        <p>
          If you've been reading carefully, you may have noticed that there's
          some low-hanging fruit here: in the case where
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >
          is a power of two, its binary representation is just a 1 followed by
          some number of 0s. In that case, we should <em>never</em> need to
          retry, but Python samples from a range exactly twice as big as it
          should be, so retries are possible. But that case only affects powers
          of two, and it turns out that we can do better even for all those
          other numbers that aren't powers of two.
        </p>
        <h2>A more clever approach</h2>
        <p>
          I say &quot;more clever&quot; instead of &quot;more smarter&quot;
          because there's probably a good reason people don't do this in
          practice. But we're gonna do it anyway! It turns out that when we
          reject a sample, we can save some of the randomness we've already
          accumulated; there's a discussion about this on
          <a href="https://stackoverflow.com/a/62920514/5044950"
            >Stack Overflow</a
          >, which links to a paper about the
          <a href="https://arxiv.org/abs/1304.1916"
            >Fast Dice Roller algorithm</a
          >. Here's a Python implementation of that algorithm (modified slightly
          for the <code>n == 1</code> case); again, we assume that we have a
          <code>flip</code> function that returns <code>0</code> half the time
          and <code>1</code> the other half of the time:
        </p>
        <pre><code class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fast_dice_roller</span>(<span class="hljs-params">n</span>):
    v = <span class="hljs-number">1</span>
    c = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">while</span> v &lt; n:
            v = <span class="hljs-number">2</span> * v
            c = <span class="hljs-number">2</span> * c + flip()
        <span class="hljs-keyword">if</span> c &lt; n:
            <span class="hljs-keyword">return</span> c
        <span class="hljs-keyword">else</span>:
            v -= n
            c -= n
</code></pre>
        <p>
          Let's walk through how this works for our 6-sided die example! So,
          <code>n == 6</code>. We'll visualize this process as a flow chart that
          goes from top to bottom and left to right (same as reading English
          prose). Each circle in the flow chart contains the value of
          <code>v</code> at that point in the process.
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 140" height="140">
            <circle
              cx="40"
              cy="20"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              1
            </text>
            <line
              x1="65"
              y1="20"
              x2="135"
              y2="20"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="15"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              3× flip
            </text>
            <circle
              cx="160"
              cy="20"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              8
            </text>
            <line
              x1="185"
              y1="20"
              x2="255"
              y2="20"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="15"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 6?
            </text>
            <circle cx="280" cy="20" r="15" fill="green"></circle>
            <text
              x="280"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <line
              x1="139.1987426415539"
              y1="33.867504905630724"
              x2="60.801257358446094"
              y2="86.13249509436928"
              stroke="red"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="55"
              fill="red"
              text-anchor="middle"
              dominant-baseline="text-bottom"
              transform="rotate(-33.690067525979785 100 60)"
            >
              subtract 6
            </text>
            <text
              x="15"
              y="100"
              fill="red"
              text-anchor="end"
              dominant-baseline="central"
            >
              ✱
            </text>
            <circle
              cx="40"
              cy="100"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="100"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              2
            </text>
            <line
              x1="65"
              y1="100"
              x2="135"
              y2="100"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="95"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              2× flip
            </text>
            <circle
              cx="160"
              cy="100"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="100"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              8
            </text>
            <line
              x1="185"
              y1="100"
              x2="255"
              y2="100"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="95"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 6?
            </text>
            <circle cx="280" cy="100" r="15" fill="green"></circle>
            <text
              x="280"
              y="100"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <text
              x="150"
              y="125"
              fill="red"
              text-anchor="end"
              dominant-baseline="hanging"
            >
              subtract 6
            </text>
            <text
              x="160"
              y="125"
              fill="red"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              ✱
            </text>
          </svg>
        </div>
        <p>
          As you can see from the code, we start with <code>v == 1</code>. We
          <code>flip</code> the coin (doubling <code>v</code> each time) until
          we have <code>v &gt;= 6</code>, which in this case takes three coin
          flips. At this point we have <code>v == 8</code>, and we check to see
          whether <code>c &lt; 6</code>. If so, we're all done! Otherwise, we
          subtract <code>6</code> from <code>v</code>, leaving
          <code>v == 2</code>. Now we only need to flip the coin
          <em>twice</em> to get back to <code>v &gt;= 6</code>. We again check;
          if <code>c &lt; 6</code> then we return, and if not then we subtract
          <code>6</code> from <code>v</code> again. But we've seen this before:
          <code>8 - 6 == 2</code>, so we've hit a cycle! This cycle is indicated
          in the diagram by a big red asterisk.
        </p>
        <p>
          We saw that once we've entered this cycle, we now only need to flip
          the coin twice for each attempt, instead of three times. OK, but does
          that actually help us? Turns out, yes, it does! Here's its expected
          number of coin flips for a given <code>n</code>, plotted in
          <span class="green">green</span>.
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 200" height="200">
            <polyline
              points="27.6,180 30.2,168.66666666666666 32.8,162.03709165849358 35.4,157.33333333333334 38,153.6848149246099 40.6,150.70375832516024 43.2,148.18331088334716 45.8,146 48.4,144.07418331698713 51,142.35148159127655 53.6,140.79310832211064 56.2,139.3704249918269 58.800000000000004,138.06168319440096 61.400000000000006,136.84997755001382 64,135.72190658310345 66.6,134.66666666666666 69.2,133.67542113249615 71.8,132.7408499836538 74.4,131.85682151430603 77,131.0181482579432 79.6,130.2204025418407 82.2,129.4597749887773 84.80000000000001,128.73296449802052 87.4,128.03709165849358 90,127.36962984921979 92.60000000000001,126.72834986106763 95.2,126.1112749754807 97.80000000000001,125.51664421668049 100.39999999999999,124.94288205522085 103,124.38857324977012 105.6,123.8524418156154 108.2,123.33333333333334 110.8,122.83019998060419 113.4,122.34208779916281 116,121.86812580795706 118.6,121.40751665032047 121.2,120.95952852287189 123.8,120.52348818097269 126.4,120.09877485289451 129,119.6848149246099 131.6,119.28107728099505 134.2,118.88706920850737 136.8,118.50233278004289 139.4,118.12644165544395 142,117.75899824159703 144.60000000000002,117.39963116468718 147.2,117.04799301432011 149.8,116.70375832516024 152.39999999999998,116.36662176669431 155,116.03629651588645 157.6,115.71251279098972 160.20000000000002,115.39501652773428 162.8,115.08356818161708 165.4,114.77794164214735 168,114.47792324672052 170.60000000000002,114.18331088334716 173.2,113.8939131727996 175.79999999999998,113.60954872188752 178.4,113.3300454405658 181,113.05523991643679 183.6,112.78497684095395 186.2,112.51910848228208 188.8,112.25749420033428 191.4,112 194,111.74649811901085 196.6,111.49686664727086 199.20000000000002,111.2509891748119 201.8,111.00875446582948 204.39999999999998,110.77005615651409 207,110.53479247462371 209.6,110.30286597894693 212.2,110.07418331698713 214.79999999999998,109.8486549993598 217.4,109.62619518953856 220,109.40672150771336 222.6,109.19015484763938 225.20000000000002,108.97641920545779 227.8,108.76544151956118 230.4,108.5571515206595 233,108.35148159127655 235.60000000000002,108.14836663397426 238.2,107.94774394766172 240.79999999999998,107.74955311140153 243.4,107.55373587517404 246,107.36023605710605 248.6,107.16899944670956 251.2,106.97997371371441 253.8,106.79310832211063 256.4,106.6083544490475 259,106.42566490826368 261.6,106.24499407774812 264.20000000000005,106.06629783135385 266.8,105.88953347410899 269.4,105.71465968098677 272,105.54163643891593 274.6,105.3704249918269 277.2,105.20098778854589 279.79999999999995,105.03328843336097 282.4,104.86729163909776 285,104.70296318255312"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="27.6,157.33333333333334 30.2,134.66666666666666 32.8,149.77777777777777 35.4,112 38,125.6 40.6,134.66666666666666 43.2,141.14285714285714 45.8,89.33333333333333 48.4,99.40740740740742 51,107.46666666666667 53.6,114.06060606060606 56.2,119.55555555555557 58.800000000000004,124.2051282051282 61.400000000000006,128.1904761904762 64,131.64444444444445 66.6,66.66666666666667 69.2,73.33333333333333 71.8,79.25925925925925 74.4,84.56140350877193 77,89.33333333333333 79.6,93.65079365079366 82.2,97.57575757575758 84.80000000000001,101.15942028985508 87.4,104.44444444444444 90,107.46666666666667 92.60000000000001,110.25641025641025 95.2,112.8395061728395 97.80000000000001,115.23809523809523 100.39999999999999,117.47126436781608 103,119.55555555555557 105.6,121.50537634408602 108.2,44 110.8,48.121212121212125 113.4,51.99999999999997 116,55.65714285714286 118.6,59.11111111111113 121.2,62.37837837837837 123.8,65.47368421052632 126.4,68.41025641025641 129,71.2 131.6,73.85365853658537 134.2,76.3809523809524 136.8,78.79069767441861 139.4,81.0909090909091 142,83.28888888888889 144.60000000000002,85.39130434782608 147.2,87.40425531914893 149.8,89.33333333333333 152.39999999999998,91.18367346938777 155,92.96 157.6,94.66666666666667 160.20000000000002,96.3076923076923 162.8,97.88679245283019 165.4,99.40740740740742 168,100.87272727272727 170.60000000000002,102.28571428571429 173.2,103.64912280701755 175.79999999999998,104.96551724137932 178.4,106.23728813559322 181,107.46666666666667 183.6,108.65573770491804 186.2,109.80645161290323 188.8,110.92063492063492 191.4,21.333333333333343 194,23.77435897435896 196.6,26.141414141414145 199.20000000000002,28.43781094527364 201.8,30.666666666666657 204.39999999999998,32.830917874396135 207,34.93333333333334 209.6,36.976525821596255 212.2,38.96296296296296 214.79999999999998,40.894977168949794 217.4,42.774774774774755 220,44.604444444444425 222.6,46.38596491228071 225.20000000000002,48.121212121212125 227.8,49.81196581196579 230.4,51.45991561181435 233,53.06666666666668 235.60000000000002,54.633744855967095 238.2,56.162601626016254 240.79999999999998,57.654618473895596 243.4,59.11111111111113 246,60.53333333333333 248.6,61.92248062015503 251.2,63.27969348659005 253.8,64.6060606060606 256.4,65.90262172284645 259,67.17037037037038 261.6,68.41025641025641 264.20000000000005,69.6231884057971 266.8,70.81003584229391 269.4,71.97163120567377 272,73.10877192982457 274.6,74.22222222222221 277.2,75.31271477663232 279.79999999999995,76.3809523809524 282.4,77.42760942760944 285,78.45333333333332"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="27.6,180 30.2,168.66666666666666 32.8,149.77777777777777 35.4,157.33333333333334 38,139.2 40.6,138.44444444444446 43.2,141.14285714285714 45.8,146 48.4,127.11111111111111 51,127.86666666666667 53.6,125.05050505050505 56.2,127.11111111111111 58.800000000000004,126.64615384615385 61.400000000000006,129.8095238095238 64,131.64444444444445 66.6,134.66666666666666 69.2,114.66666666666666 71.8,115.77777777777779 74.4,115.13710201429501 77,116.53333333333333 79.6,118.47619047619048 82.2,113.71717171717171 84.80000000000001,115.37730011398796 87.4,115.77777777777779 90,117.08617886178862 92.60000000000001,115.31282051282052 95.2,116.37426900584798 97.80000000000001,118.47619047619048 100.39999999999999,118.38844471569524 103,120.31111111111112 105.6,121.50537634408602 108.2,123.33333333333334 110.8,102.38383838383838 113.4,103.33333333333333 116,103.63630443630444 118.6,104.44444444444444 121.2,103.046085181865 123.8,103.80376868096167 126.4,105.27472527472527 129,105.2 131.6,105.76390243902438 134.2,107.14285714285714 136.8,101.28165374677003 139.4,102.38383838383838 142,102.99975579975579 144.60000000000002,104.04396678065463 147.2,103.49207919741622 149.8,104.44444444444444 152.39999999999998,104.8822280004317 155,105.7528455284553 157.6,107.1111111111111 160.20000000000002,103.9794871794872 162.8,104.90618203720179 165.4,105.04093567251462 168,106.19431132727749 170.60000000000002,107.14285714285714 173.2,105.90253411306045 175.79999999999998,107.05511138236191 178.4,107.80656339264183 181,108.97777777777779 183.6,109.0608606291368 186.2,110.17204301075269 188.8,110.92063492063492 191.4,112 194,90.3794871794872 196.6,91.05050505050504 199.20000000000002,91.3757216071195 201.8,91.99999999999999 204.39999999999998,91.53330569266612 207,92.30297110297111 209.6,92.4940034903264 212.2,93.11111111111111 214.79999999999998,93.99086757990868 217.4,91.71275184853165 220,92.34539573548228 222.6,92.47043534762834 225.20000000000002,93.28145906324326 227.8,93.94139194139193 230.4,93.08525881597797 233,93.86666666666667 235.60000000000002,94.47276575511111 238.2,94.43056910569105 240.79999999999998,95.22314384102573 243.4,95.80952380952381 246,96.53333333333333 248.6,89.9483204134367 251.2,90.61206841945177 253.8,91.05050505050504 256.4,91.7361993160723 259,91.66642246642246 261.6,92.3223443223443 264.20000000000005,92.7106334473213 266.8,93.34376018246986 269.4,92.15874586408287 272,92.74567325751916 274.6,93.11111111111111 277.2,93.69563545610694 279.79999999999995,93.54889466709838 282.4,94.09783636973968 285,94.41951219512195"
              fill="none"
              stroke="hsl(111 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="20"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              15
            </text>
            <text
              x="20"
              y="180"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0
            </text>
            <text
              x="77"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="129"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              40
            </text>
            <text
              x="181"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              60
            </text>
            <text
              x="233"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              80
            </text>
            <text
              x="285"
              y="185"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              100
            </text>
            <polyline
              points="25,10 25,180 285,180"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          As you can see, while the <span class="red">red</span> curve can be up
          to double the height of the <span class="blue">blue</span> curve at a
          given point, the <span class="green">green</span> curve is never more
          than 2 flips above the <span class="blue">blue</span> curve.
        </p>
        <p>
          Now you know not only how your computer rolls dice, but also how it
          <em>could</em> roll dice even better. But... look at the shape of that
          graph. Kinda weird, right? Doesn't it just tug at your brain and make
          you want to understand it a bit more?
        </p>
        <h2>More math</h2>
        <p>
          The key invariant in this algorithm is that, at the start every
          iteration of the <code>while True</code> loop, <code>c</code> is
          always a uniformly random nonnegative integer less than
          <code>v</code>. At the start we have <code>v == 1</code>, so the only
          such integer is <code>0</code>, and indeed that is <code>c</code>'s
          value! Now, think about what we do inside the inner
          <code>while</code> loop. We double <code>v</code>, so now
          <code>c</code> needs to be uniformly distributed across twice as many
          possible values. We start by doubling <code>c</code>. This always
          produces a value that is even! So we're missing all the odd values
          less than <code>v</code>. Then, the <code>flip</code> function always
          returns either <code>0</code> or <code>1</code>, so when we add its
          result after doubling <code>c</code>, we have a 50% chance to stay on
          an even value, and a 50% to go to the odd value immediately following
          it. We've restored the invariant that <code>c</code> is uniformly
          sampled from all nonnegative integers less than <code>v</code>.
        </p>
        <p>
          But that's all the same as in our earlier rejection sampling approach.
          The trick is what we do after we check <code>if c &lt; n</code>. When
          this is <code>True</code>, remember that <code>c</code> was uniformly
          sampled, so all the nonnegative integers less than <code>n</code> were
          equally likely, and so we just <code>return c</code>. But if it's
          <code>False</code>, now we know for a fact that
          <code>c &gt;= n</code>. And again, all those nonnegative integers at
          least <code>n</code> but less than <code>v</code> were equally likely,
          so if we subtract <code>n</code> from both <code>v</code> and
          <code>c</code>, we maintain our invariant! Now <code>v</code> is a
          smaller value, but it's often still greater than <code>1</code>, so we
          can use some of the randomness we've already gotten to avoid flipping
          our coin quite as many times. You can see this in the diagram above:
          if we were just doing rejection sampling then we'd have to flip the
          coin three times every time we failed, but in this case we flip three
          times only at first, and then after that we only flip twice on every
          subsequent iteration.
        </p>
        <p>
          That was but a simple example. Actually, there are even simpler ones:
          if we have a power of two like <code>n == 32</code>, there is no cycle
          at all; we just <code>flip</code> our coin a few times and then
          <code>return</code>.
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 40" height="40">
            <circle
              cx="40"
              cy="20"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              1
            </text>
            <line
              x1="65"
              y1="20"
              x2="135"
              y2="20"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="15"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              5× flip
            </text>
            <circle
              cx="160"
              cy="20"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              32
            </text>
            <line
              x1="185"
              y1="20"
              x2="255"
              y2="20"
              stroke="green"
              stroke-width="2"
            ></line>
            <circle cx="280" cy="20" r="15" fill="green"></circle>
            <text
              x="280"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
          </svg>
        </div>
        <p>
          But these cycles can also get much longer: here's
          <code>n == 11</code>.
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 380" height="380">
            <text
              x="15"
              y="20"
              fill="red"
              text-anchor="end"
              dominant-baseline="central"
            >
              ✱
            </text>
            <circle
              cx="40"
              cy="20"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              1
            </text>
            <line
              x1="65"
              y1="20"
              x2="135"
              y2="20"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="15"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              4× flip
            </text>
            <circle
              cx="160"
              cy="20"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              16
            </text>
            <line
              x1="185"
              y1="20"
              x2="255"
              y2="20"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="15"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 11?
            </text>
            <circle cx="280" cy="20" r="15" fill="green"></circle>
            <text
              x="280"
              y="20"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <line
              x1="139.1987426415539"
              y1="33.867504905630724"
              x2="60.801257358446094"
              y2="86.13249509436928"
              stroke="red"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="55"
              fill="red"
              text-anchor="middle"
              dominant-baseline="text-bottom"
              transform="rotate(-33.690067525979785 100 60)"
            >
              subtract 11
            </text>
            <circle
              cx="40"
              cy="100"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="100"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              5
            </text>
            <line
              x1="65"
              y1="100"
              x2="135"
              y2="100"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="95"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              2× flip
            </text>
            <circle
              cx="160"
              cy="100"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="100"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              20
            </text>
            <line
              x1="185"
              y1="100"
              x2="255"
              y2="100"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="95"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 11?
            </text>
            <circle cx="280" cy="100" r="15" fill="green"></circle>
            <text
              x="280"
              y="100"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <line
              x1="139.1987426415539"
              y1="113.86750490563072"
              x2="60.801257358446094"
              y2="166.13249509436926"
              stroke="red"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="135"
              fill="red"
              text-anchor="middle"
              dominant-baseline="text-bottom"
              transform="rotate(-33.690067525979785 100 140)"
            >
              subtract 11
            </text>
            <circle
              cx="40"
              cy="180"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="180"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              9
            </text>
            <line
              x1="65"
              y1="180"
              x2="135"
              y2="180"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="175"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              1× flip
            </text>
            <circle
              cx="160"
              cy="180"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="180"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              18
            </text>
            <line
              x1="185"
              y1="180"
              x2="255"
              y2="180"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="175"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 11?
            </text>
            <circle cx="280" cy="180" r="15" fill="green"></circle>
            <text
              x="280"
              y="180"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <line
              x1="139.1987426415539"
              y1="193.86750490563074"
              x2="60.801257358446094"
              y2="246.13249509436926"
              stroke="red"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="215"
              fill="red"
              text-anchor="middle"
              dominant-baseline="text-bottom"
              transform="rotate(-33.690067525979785 100 220)"
            >
              subtract 11
            </text>
            <circle
              cx="40"
              cy="260"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="260"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              7
            </text>
            <line
              x1="65"
              y1="260"
              x2="135"
              y2="260"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="255"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              1× flip
            </text>
            <circle
              cx="160"
              cy="260"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="260"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              14
            </text>
            <line
              x1="185"
              y1="260"
              x2="255"
              y2="260"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="255"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 11?
            </text>
            <circle cx="280" cy="260" r="15" fill="green"></circle>
            <text
              x="280"
              y="260"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <line
              x1="139.1987426415539"
              y1="273.8675049056307"
              x2="60.801257358446094"
              y2="326.1324950943693"
              stroke="red"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="295"
              fill="red"
              text-anchor="middle"
              dominant-baseline="text-bottom"
              transform="rotate(-33.690067525979785 100 300)"
            >
              subtract 11
            </text>
            <circle
              cx="40"
              cy="340"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="40"
              y="340"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              3
            </text>
            <line
              x1="65"
              y1="340"
              x2="135"
              y2="340"
              stroke="white"
              stroke-width="2"
            ></line>
            <text
              x="100"
              y="335"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              2× flip
            </text>
            <circle
              cx="160"
              cy="340"
              r="15"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></circle>
            <text
              x="160"
              y="340"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              12
            </text>
            <line
              x1="185"
              y1="340"
              x2="255"
              y2="340"
              stroke="green"
              stroke-width="2"
            ></line>
            <text
              x="220"
              y="335"
              fill="green"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              &lt; 11?
            </text>
            <circle cx="280" cy="340" r="15" fill="green"></circle>
            <text
              x="280"
              y="340"
              fill="white"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ✓
            </text>
            <text
              x="150"
              y="365"
              fill="red"
              text-anchor="end"
              dominant-baseline="hanging"
            >
              subtract 11
            </text>
            <text
              x="160"
              y="365"
              fill="red"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              ✱
            </text>
          </svg>
        </div>
        <p>
          This is a lot more interesting! In our <code>n == 6</code> example the
          cycle only went back to the previous node in the flow chart, but here
          it went all the way back to the beginning. So the cycles can be
          different lengths. Here are the first few of those cycle lengths, for
          <code>n == 1</code> through <code>n == 40</code>, and for powers of
          two where there's no cycle, I've inserted 1 as a placeholder value.
          (Try using 0 instead for a different rabbit hole!)
        </p>
        <blockquote>
          <p>
            1, 1, 1, 1, 2, 1, 1, 1, 3, 2, 5, 1, 6, 1, 1, 1, 4, 3, 9, 2, 2, 5, 4,
            1, 10, 6, 9, 1, 14, 1, 1, 1, 5, 4, 5, 3, 18, 9, 4, 2, ...
          </p>
        </blockquote>
        <p>
          Turns out, if you look up this sequence, it already has a name! It's
          called <a href="https://oeis.org/A136043">A136043</a>:
        </p>
        <blockquote>
          <p>
            Period-lengths of the base-<span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>2</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >2</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">2</span></span
                ></span
              ></span
            >
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mtext
                        ><mi mathvariant="normal">M</mi
                        ><mi mathvariant="normal">R</mi></mtext
                      ></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{MR}</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.68333em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.68333em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="text mord textstyle uncramped"
                    ><span class="mord mathrm">M</span
                    ><span class="mord mathrm">R</span></span
                  ></span
                ></span
              ></span
            >-expansions of the reciprocals of the positive integers.
          </p>
        </blockquote>
        <p>
          Neat! The bit about &quot;reciprocals of the positive integers&quot;
          makes sense, because if you're trying to uniformly sample a
          nonnegative integer less than
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.43056em"></span
              ><span
                class="strut bottom"
                style="height: 0.43056em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >, the chance of getting <em>any specific possibility</em> should be
          equal to
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow
                    ><mn>1</mn><mi mathvariant="normal">/</mi><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >1/n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.75em"></span
              ><span
                class="strut bottom"
                style="height: 1em; vertical-align: -0.25em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathrm">1</span
                ><span class="mord mathrm">/</span
                ><span class="mord mathit">n</span></span
              ></span
            ></span
          >. What is an
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow
                    ><mtext
                      ><mi mathvariant="normal">M</mi
                      ><mi mathvariant="normal">R</mi></mtext
                    ></mrow
                  ><annotation encoding="application/x-tex"
                    >\text{MR}</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.68333em"></span
              ><span
                class="strut bottom"
                style="height: 0.68333em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="text mord textstyle uncramped"
                  ><span class="mord mathrm">M</span
                  ><span class="mord mathrm">R</span></span
                ></span
              ></span
            ></span
          >-expansion, though? Turns out it's defined in
          <a href="https://oeis.org/A136042">OEIS A136042</a> (that page
          actually has a couple errors, which I've corrected here):
        </p>
        <blockquote>
          <p>
            The base-<span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mi>m</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >m</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.43056em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.43056em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">m</span></span
                ></span
              ></span
            >
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mtext
                        ><mi mathvariant="normal">M</mi
                        ><mi mathvariant="normal">R</mi></mtext
                      ></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{MR}</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.68333em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.68333em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="text mord textstyle uncramped"
                    ><span class="mord mathrm">M</span
                    ><span class="mord mathrm">R</span></span
                  ></span
                ></span
              ></span
            >-expansion of a positive real number
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mi>x</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >x</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.43056em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.43056em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">x</span></span
                ></span
              ></span
            >, denoted by
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mtext
                        ><mi mathvariant="normal">M</mi
                        ><mi mathvariant="normal">R</mi></mtext
                      ><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>m</mi
                      ><mo>)</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{MR}(x, m)</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="text mord textstyle uncramped"
                    ><span class="mord mathrm">M</span
                    ><span class="mord mathrm">R</span></span
                  ><span class="mopen">(</span><span class="mord mathit">x</span
                  ><span class="mpunct">,</span
                  ><span class="mord mathit">m</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            >, is the integer sequence
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mo>{</mo><mi>s</mi><mo>(</mo><mn>1</mn><mo>)</mo
                      ><mo separator="true">,</mo><mi>s</mi><mo>(</mo><mn>2</mn
                      ><mo>)</mo><mo separator="true">,</mo><mi>s</mi><mo>(</mo
                      ><mn>3</mn><mo>)</mo><mo separator="true">,</mo><mo>…</mo
                      ><mo>}</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >\{s(1), s(2), s(3), \ldots\}</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mopen">{</span><span class="mord mathit">s</span
                  ><span class="mopen">(</span><span class="mord mathrm">1</span
                  ><span class="mclose">)</span><span class="mpunct">,</span
                  ><span class="mord mathit">s</span><span class="mopen">(</span
                  ><span class="mord mathrm">2</span
                  ><span class="mclose">)</span><span class="mpunct">,</span
                  ><span class="mord mathit">s</span><span class="mopen">(</span
                  ><span class="mord mathrm">3</span
                  ><span class="mclose">)</span><span class="mpunct">,</span
                  ><span class="minner">…</span
                  ><span class="mclose">}</span></span
                ></span
              ></span
            >, where
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mi>s</mi><mo>(</mo><mi>i</mi><mo>)</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >s(i)</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">s</span><span class="mopen">(</span
                  ><span class="mord mathit">i</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            >
            is the smallest exponent
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mi>d</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >d</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.69444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.69444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">d</span></span
                ></span
              ></span
            >
            such that
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mo>(</mo><msup><mi>m</mi><mi>d</mi></msup
                      ><mo>)</mo><mi>x</mi><mo>(</mo><mi>i</mi><mo>)</mo
                      ><mo>&gt;</mo><mn>1</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >(m^d)x(i) &gt; 1</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.849108em"></span
                ><span
                  class="strut bottom"
                  style="height: 1.099108em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathit">m</span
                    ><span class="vlist"
                      ><span style="top: -0.363em; margin-right: 0.05em"
                        ><span class="fontsize-ensurer reset-size5 size5"
                          ><span style="font-size: 0em">​</span></span
                        ><span class="reset-textstyle scriptstyle uncramped"
                          ><span class="mord mathit">d</span></span
                        ></span
                      ><span class="baseline-fix"
                        ><span class="fontsize-ensurer reset-size5 size5"
                          ><span style="font-size: 0em">​</span></span
                        >​</span
                      ></span
                    ></span
                  ><span class="mclose">)</span
                  ><span class="mord mathit">x</span><span class="mopen">(</span
                  ><span class="mord mathit">i</span
                  ><span class="mclose">)</span><span class="mrel">&gt;</span
                  ><span class="mord mathrm">1</span></span
                ></span
              ></span
            >
            and where
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mi>x</mi><mo>(</mo><mi>i</mi><mo>+</mo><mn>1</mn
                      ><mo>)</mo><mo>=</mo><mo>(</mo
                      ><msup><mi>m</mi><mi>d</mi></msup
                      ><mo>)</mo><mi>x</mi><mo>(</mo><mi>i</mi><mo>)</mo
                      ><mo>−</mo><mn>1</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >x(i + 1) = (m^d)x(i) - 1</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.849108em"></span
                ><span
                  class="strut bottom"
                  style="height: 1.099108em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">x</span><span class="mopen">(</span
                  ><span class="mord mathit">i</span><span class="mbin">+</span
                  ><span class="mord mathrm">1</span
                  ><span class="mclose">)</span><span class="mrel">=</span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathit">m</span
                    ><span class="vlist"
                      ><span style="top: -0.363em; margin-right: 0.05em"
                        ><span class="fontsize-ensurer reset-size5 size5"
                          ><span style="font-size: 0em">​</span></span
                        ><span class="reset-textstyle scriptstyle uncramped"
                          ><span class="mord mathit">d</span></span
                        ></span
                      ><span class="baseline-fix"
                        ><span class="fontsize-ensurer reset-size5 size5"
                          ><span style="font-size: 0em">​</span></span
                        >​</span
                      ></span
                    ></span
                  ><span class="mclose">)</span
                  ><span class="mord mathit">x</span><span class="mopen">(</span
                  ><span class="mord mathit">i</span
                  ><span class="mclose">)</span><span class="mbin">−</span
                  ><span class="mord mathrm">1</span></span
                ></span
              ></span
            >, with the initialization
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mi>x</mi><mo>(</mo><mn>1</mn><mo>)</mo><mo>=</mo
                      ><mi>x</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >x(1) = x</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">x</span><span class="mopen">(</span
                  ><span class="mord mathrm">1</span
                  ><span class="mclose">)</span><span class="mrel">=</span
                  ><span class="mord mathit">x</span></span
                ></span
              ></span
            >. The base-<span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>2</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >2</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">2</span></span
                ></span
              ></span
            >
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mtext
                        ><mi mathvariant="normal">M</mi
                        ><mi mathvariant="normal">R</mi></mtext
                      ></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{MR}</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.68333em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.68333em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="text mord textstyle uncramped"
                    ><span class="mord mathrm">M</span
                    ><span class="mord mathrm">R</span></span
                  ></span
                ></span
              ></span
            >-expansion of
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn
                      ><mn>9</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >1/29</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">1</span
                  ><span class="mord mathrm">/</span
                  ><span class="mord mathrm">2</span
                  ><span class="mord mathrm">9</span></span
                ></span
              ></span
            >
            is periodic with period length
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>1</mn><mn>4</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >14</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">1</span
                  ><span class="mord mathrm">4</span></span
                ></span
              ></span
            >. Further computational results (see
            <a href="https://oeis.org/A136043">A136043</a>) suggest that if
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mi>p</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >p</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.43056em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.625em; vertical-align: -0.19444em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">p</span></span
                ></span
              ></span
            >
            is a prime with
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>2</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >2</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">2</span></span
                ></span
              ></span
            >
            as a primitive root, then the base-<span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>2</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >2</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">2</span></span
                ></span
              ></span
            >
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mtext
                        ><mi mathvariant="normal">M</mi
                        ><mi mathvariant="normal">R</mi></mtext
                      ></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{MR}</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.68333em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.68333em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="text mord textstyle uncramped"
                    ><span class="mord mathrm">M</span
                    ><span class="mord mathrm">R</span></span
                  ></span
                ></span
              ></span
            >-expansion of
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mn>1</mn><mi mathvariant="normal">/</mi><mi>p</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >1/p</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">1</span
                  ><span class="mord mathrm">/</span
                  ><span class="mord mathit">p</span></span
                ></span
              ></span
            >
            is periodic with period
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mo>(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo>)</mo
                      ><mi mathvariant="normal">/</mi><mn>2</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >(p - 1)/2</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.75em"></span
                ><span
                  class="strut bottom"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mopen">(</span><span class="mord mathit">p</span
                  ><span class="mbin">−</span><span class="mord mathrm">1</span
                  ><span class="mclose">)</span
                  ><span class="mord mathrm">/</span
                  ><span class="mord mathrm">2</span></span
                ></span
              ></span
            >. This has been confirmed for primes up to
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>2</mn><mn>0</mn><mn>0</mn><mn>0</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >2000</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">2</span
                  ><span class="mord mathrm">0</span
                  ><span class="mord mathrm">0</span
                  ><span class="mord mathrm">0</span></span
                ></span
              ></span
            >. The base-<span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow><mn>2</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >2</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathrm">2</span></span
                ></span
              ></span
            >
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mtext
                        ><mi mathvariant="normal">M</mi
                        ><mi mathvariant="normal">R</mi></mtext
                      ></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{MR}</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.68333em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.68333em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="text mord textstyle uncramped"
                    ><span class="mord mathrm">M</span
                    ><span class="mord mathrm">R</span></span
                  ></span
                ></span
              ></span
            >-expansion of
            <span class="katex"
              ><span class="katex-mathml"
                ><math
                  ><semantics
                    ><mrow
                      ><mi>e</mi><mo>=</mo><mn>2</mn
                      ><mi mathvariant="normal">.</mi><mn>7</mn><mn>1</mn
                      ><mn>8</mn><mn>2</mn><mn>8</mn><mo>…</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >e = 2.71828\ldots</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="strut" style="height: 0.64444em"></span
                ><span
                  class="strut bottom"
                  style="height: 0.64444em; vertical-align: 0em"
                ></span
                ><span class="base textstyle uncramped"
                  ><span class="mord mathit">e</span><span class="mrel">=</span
                  ><span class="mord mathrm">2</span
                  ><span class="mord mathrm">.</span
                  ><span class="mord mathrm">7</span
                  ><span class="mord mathrm">1</span
                  ><span class="mord mathrm">8</span
                  ><span class="mord mathrm">2</span
                  ><span class="mord mathrm">8</span
                  ><span class="minner">…</span></span
                ></span
              ></span
            >
            is given in <a href="https://oeis.org/A136044">A136044</a>.
          </p>
        </blockquote>
        <p>
          This is a bit dense and I'm not going to work through it in detail
          here, but if you think about it, it roughly matches up with the
          algorithm we've been examining. See how it mentions &quot;the smallest
          exponent
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>d</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >d</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.69444em"></span
              ><span
                class="strut bottom"
                style="height: 0.69444em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">d</span></span
              ></span
            ></span
          >&quot;? That's the same as our number of coin flips in each row of
          the diagrams we've been looking at! Each flip doubles <code>v</code>,
          so that's exponentiation right there. The process of defining
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow
                    ><mi>x</mi><mo>(</mo><mi>i</mi><mo>+</mo><mn>1</mn
                    ><mo>)</mo></mrow
                  ><annotation encoding="application/x-tex"
                    >x(i + 1)</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.75em"></span
              ><span
                class="strut bottom"
                style="height: 1em; vertical-align: -0.25em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">x</span><span class="mopen">(</span
                ><span class="mord mathit">i</span><span class="mbin">+</span
                ><span class="mord mathrm">1</span
                ><span class="mclose">)</span></span
              ></span
            ></span
          >
          in terms of
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>x</mi><mo>(</mo><mi>i</mi><mo>)</mo></mrow
                  ><annotation encoding="application/x-tex"
                    >x(i)</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.75em"></span
              ><span
                class="strut bottom"
                style="height: 1em; vertical-align: -0.25em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">x</span><span class="mopen">(</span
                ><span class="mord mathit">i</span
                ><span class="mclose">)</span></span
              ></span
            ></span
          >
          and
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow
                    ><msup><mi>m</mi><mi>d</mi></msup></mrow
                  ><annotation encoding="application/x-tex"
                    >m^d</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.849108em"></span
              ><span
                class="strut bottom"
                style="height: 0.849108em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord"
                  ><span class="mord mathit">m</span
                  ><span class="vlist"
                    ><span style="top: -0.363em; margin-right: 0.05em"
                      ><span class="fontsize-ensurer reset-size5 size5"
                        ><span style="font-size: 0em">​</span></span
                      ><span class="reset-textstyle scriptstyle uncramped"
                        ><span class="mord mathit">d</span></span
                      ></span
                    ><span class="baseline-fix"
                      ><span class="fontsize-ensurer reset-size5 size5"
                        ><span style="font-size: 0em">​</span></span
                      >​</span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >
          (where
          <span class="katex"
            ><span class="katex-mathml"
              ><math
                ><semantics
                  ><mrow><mi>m</mi><mo>=</mo><mn>2</mn></mrow
                  ><annotation encoding="application/x-tex"
                    >m = 2</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="strut" style="height: 0.64444em"></span
              ><span
                class="strut bottom"
                style="height: 0.64444em; vertical-align: 0em"
              ></span
              ><span class="base textstyle uncramped"
                ><span class="mord mathit">m</span><span class="mrel">=</span
                ><span class="mord mathrm">2</span></span
              ></span
            ></span
          >
          in our case) is essentially the same as our process of going from one
          row of the diagram to the next.
        </p>
        <p>
          That's all I'll say about this sequence for now, but by all means dig
          further into this definition if you're curious! And if you think about
          it and look back at the diagrams we've been drawing, there are a
          couple other sequences we could define instead... can you find any of
          those in the OEIS?
        </p>
        <h2>Conclusion</h2>
        <p>And there you have it: we learned</p>
        <ol>
          <li>how your computer probably rolls dice,</li>
          <li>a cleverer way your computer could roll dice, and</li>
          <li>
            some fun math about patterns that emerge from that cleverer way.
          </li>
        </ol>
        <p>
          One question you may still have is, how do computers flip coins in the
          first place? We kind of swept that under the rug at the beginning.
          Others have already written more about this, but simplifying a lot,
          your computer looks at something unpredictable in the real world, e.g.
          <a
            href="https://blog.cloudflare.com/lavarand-in-production-the-nitty-gritty-technical-details/"
            >lava lamps</a
          >, and uses some math to slice and dice what it sees into a sequence
          of random bits. Then your computer hands out those random bits to
          programs that ask for them, like the functions we've been looking at
          in this post.
        </p>
        <p>
          Hopefully you had fun reading this! Once I've published this I'll post
          it on
          <a href="https://news.ycombinator.com/user?id=sestep">Hacker News</a>
          and on <a href="https://twitter.com/sgestep">Twitter</a>, so feel free
          to reply there with any questions or comments!
        </p>
      </div>
    </main>
  </body>
</html>
