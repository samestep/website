<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/monokai.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"
    />
    <link rel="stylesheet" href="/blog.css" />
    <title>How much slower is random access, really? | Sam Estep</title>
  </head>
  <body>
    <main>
      <h1>How much slower is random access, really?</h1>
      <p>
        <em>by <a href="/">Sam Estep</a>, unpublished</em>
      </p>
      <div>
        <p>
          I've been enjoying learning about data-oriented design (DoD) lately.
          It's exciting to dream of a future where all our compilers are faster!
        </p>
        <ul>
          <li>
            <a href="https://blog.nelhage.com/post/why-sorbet-is-fast/"
              >Sorbet</a
            >
          </li>
          <li><a href="https://youtu.be/ZI198eFghJk">Carbon</a></li>
          <li><a href="https://youtu.be/IroPQ150F6c">Zig</a></li>
          <li>Jai (I don't have a good video link for this one)</li>
        </ul>
        <p>
          When I mentioned some of these ideas with a friend, he asked
          <em>how much</em> of a difference it actually makes to access data in
          cache-friendly vs cache-unfriendly ways. He's working in the more
          theoretical context of
          <a href="https://en.wikipedia.org/wiki/Streaming_algorithm"
            >streaming algorithms</a
          >, so really he just wanted to know how justified he is in switching
          between &quot;arbitrary order&quot; and &quot;random order&quot; as
          necessary.
        </p>
        <p>
          But I realized that, while I have some high-level intuitions, and some
          of those videos I've been watching give performance numbers for whole
          pieces of software, I don't actually know what the numbers look like
          for simple programs. So let's measure!
        </p>
        <h2>Setup</h2>
        <p>
          Let's say you have an array of floating-point numbers in memory. You
          can add those numbers up in any order you like. Let's consider two
          possible orderings:
        </p>
        <ol>
          <li>First to last.</li>
          <li>Random.</li>
        </ol>
        <p>
          You won't necessarily get the same answer because
          <a href="https://walkingrandomly.com/?p=5380"
            >floating-point addition is not associative</a
          >; I kind of like that for this experiment because it means I can more
          easily trust the compiler not to do optimizations I don't expect.
        </p>
        <p>
          To specify the order, we'll just have another array that holds
          integers. That way, once we've chosen the precisions for our
          floating-point and integer data types, we should be using the
          <em>exact same machine code</em> for forward order, random order, or
          any other order we want. The performance should be entirely determined
          by <em>dynamic</em> behavior in the CPU based on the data we're using.
        </p>
        <p>
          By the way, all the code to reproduce the measurements in this blog
          post can be found in a
          <a
            href="https://github.com/samestep/random-access/tree/45ffc8fa71afefbe3a9c5e2ed68f1974335b1b25"
            >supplementary repository on GitHub</a
          >.
        </p>
        <details>
          <summary>Expand this to see some Rust code.</summary>
          <pre><code class="language-rust"><span class="hljs-keyword">use</span> std::ops::{AddAssign, Index};

<span class="hljs-keyword">use</span> num::{Float, Num, traits::ToBytes};

<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Number</span>: <span class="hljs-built_in">Sized</span> + <span class="hljs-built_in">Copy</span> + <span class="hljs-built_in">Into</span>&lt;<span class="hljs-type">f64</span>&gt; + AddAssign + Num + Float + ToBytes {}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Number</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">f32</span> {}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Number</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">f64</span> {}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sum</span>&lt;T: Number, I: <span class="hljs-built_in">Copy</span>&gt;(floats: &amp;[T], indices: &amp;[I]) <span class="hljs-punctuation">-&gt;</span> T
<span class="hljs-keyword">where</span>
    [T]: Index&lt;I, Output = T&gt;,
{
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">total</span> = T::<span class="hljs-title function_ invoke__">zero</span>();
    <span class="hljs-keyword">for</span> &amp;i <span class="hljs-keyword">in</span> indices {
        total += floats[i];
    }
    total
}

<span class="hljs-meta">#[test]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_sum_f64_usize_not_associative</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">floats</span>: &amp;[<span class="hljs-type">f64</span>] = &amp;[<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-variable">forward</span>: &amp;[<span class="hljs-type">usize</span>] = &amp;[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-variable">backward</span>: &amp;[<span class="hljs-type">usize</span>] = &amp;[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>];
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-title function_ invoke__">sum</span>(floats, forward), <span class="hljs-number">0.6000000000000001</span>);
    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-title function_ invoke__">sum</span>(floats, backward), <span class="hljs-number">0.6</span>);
}
</code></pre>
        </details>
        <p>
          Now all we need to do is generate some random data. For the
          floating-point numbers we can just use a
          <a href="https://en.wikipedia.org/wiki/Normal_distribution"
            >normal distribution</a
          >, and for the integer indices we can just take the list of integers
          up to the length of our array, and
          <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle"
            >shuffle</a
          >
          it to get a random order.
        </p>
        <p>
          Or rather, that's what I thought at first. Small spoiler: further down
          we're going to do some experiments with arrays too big to fit in
          memory, and for those, Fisherâ€“Yates turned out to be way too slow. So
          instead I implemented a
          <a href="https://blog.janestreet.com/how-to-shuffle-a-big-dataset/"
            >two-pass shuffle</a
          >
          which first partitions the array into chunks that are about a gigabyte
          each.
        </p>
        <details>
          <summary>Code to generate our random data.</summary>
          <pre><code class="language-rust"><span class="hljs-keyword">use</span> std::{
    fmt, fs,
    io::{<span class="hljs-keyword">self</span>, Read, Seek, Write},
};

<span class="hljs-keyword">use</span> rand::Rng;
<span class="hljs-keyword">use</span> rand_distr::{Distribution, Normal, StandardNormal};
<span class="hljs-keyword">use</span> tempfile::tempfile;

<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Int</span>: TryFrom&lt;<span class="hljs-type">usize</span>, Error: fmt::<span class="hljs-built_in">Debug</span>&gt; + ToBytes {}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Int</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">u32</span> {}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Int</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">u64</span> {}

<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Progress</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(len: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">step</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>);
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">random_floats</span>&lt;T: Number, P: Progress&gt;(rng: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Rng</span>, <span class="hljs-keyword">mut</span> writer: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Write</span>, n: <span class="hljs-type">usize</span>)
<span class="hljs-keyword">where</span>
    StandardNormal: Distribution&lt;T&gt;,
{
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">progress</span> = P::<span class="hljs-title function_ invoke__">new</span>(n);
    <span class="hljs-keyword">let</span> <span class="hljs-variable">normal</span> = Normal::&lt;T&gt;::<span class="hljs-title function_ invoke__">new</span>(T::<span class="hljs-title function_ invoke__">zero</span>(), T::<span class="hljs-title function_ invoke__">one</span>()).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">for</span> <span class="hljs-variable">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..n {
        <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = normal.<span class="hljs-title function_ invoke__">sample</span>(rng);
        writer.<span class="hljs-title function_ invoke__">write_all</span>(x.<span class="hljs-title function_ invoke__">to_ne_bytes</span>().<span class="hljs-title function_ invoke__">as_ref</span>()).<span class="hljs-title function_ invoke__">unwrap</span>();
        progress.<span class="hljs-title function_ invoke__">step</span>();
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">first_to_last</span>&lt;I: Int, P: Progress&gt;(<span class="hljs-keyword">mut</span> writer: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Write</span>, n: <span class="hljs-type">usize</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">progress</span> = P::<span class="hljs-title function_ invoke__">new</span>(n);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..n {
        writer
            .<span class="hljs-title function_ invoke__">write_all</span>(I::<span class="hljs-title function_ invoke__">try_from</span>(i).<span class="hljs-title function_ invoke__">unwrap</span>().<span class="hljs-title function_ invoke__">to_ne_bytes</span>().<span class="hljs-title function_ invoke__">as_ref</span>())
            .<span class="hljs-title function_ invoke__">unwrap</span>();
        progress.<span class="hljs-title function_ invoke__">step</span>();
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">permutation</span>&lt;I: Int, P: Progress&gt;(rng: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Rng</span>, <span class="hljs-keyword">mut</span> writer: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Write</span>, n: <span class="hljs-type">usize</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = (n * size_of::&lt;I&gt;()).<span class="hljs-title function_ invoke__">div_ceil</span>(<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">progress</span> = P::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">2</span> * n);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">files</span>: <span class="hljs-type">Vec</span>&lt;fs::File&gt; = (<span class="hljs-number">0</span>..m).<span class="hljs-title function_ invoke__">map</span>(|_| <span class="hljs-title function_ invoke__">tempfile</span>().<span class="hljs-title function_ invoke__">unwrap</span>()).<span class="hljs-title function_ invoke__">collect</span>();
    {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">writers</span>: <span class="hljs-type">Vec</span>&lt;io::BufWriter&lt;_&gt;&gt; = files.<span class="hljs-title function_ invoke__">iter_mut</span>().<span class="hljs-title function_ invoke__">map</span>(io::BufWriter::new).<span class="hljs-title function_ invoke__">collect</span>();
        <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..n {
            <span class="hljs-keyword">let</span> <span class="hljs-variable">j</span> = rng.<span class="hljs-title function_ invoke__">random_range</span>(<span class="hljs-number">0</span>..m);
            writers[j]
                .<span class="hljs-title function_ invoke__">write_all</span>(I::<span class="hljs-title function_ invoke__">try_from</span>(i).<span class="hljs-title function_ invoke__">unwrap</span>().<span class="hljs-title function_ invoke__">to_ne_bytes</span>().<span class="hljs-title function_ invoke__">as_ref</span>())
                .<span class="hljs-title function_ invoke__">unwrap</span>();
            progress.<span class="hljs-title function_ invoke__">step</span>();
        }
    }
    <span class="hljs-keyword">for</span> <span class="hljs-title class_">mut</span> file <span class="hljs-keyword">in</span> files {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">bytes</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>();
        file.<span class="hljs-title function_ invoke__">seek</span>(io::SeekFrom::<span class="hljs-title function_ invoke__">Start</span>(<span class="hljs-number">0</span>)).<span class="hljs-title function_ invoke__">unwrap</span>();
        file.<span class="hljs-title function_ invoke__">read_to_end</span>(&amp;<span class="hljs-keyword">mut</span> bytes).<span class="hljs-title function_ invoke__">unwrap</span>();
        <span class="hljs-keyword">let</span> (prefix, values, suffix) = <span class="hljs-keyword">unsafe</span> { bytes.align_to_mut::&lt;I&gt;() };
        <span class="hljs-built_in">assert!</span>(prefix.<span class="hljs-title function_ invoke__">is_empty</span>());
        <span class="hljs-built_in">assert!</span>(suffix.<span class="hljs-title function_ invoke__">is_empty</span>());
        <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..values.<span class="hljs-title function_ invoke__">len</span>() {
            <span class="hljs-keyword">let</span> <span class="hljs-variable">j</span> = rng.<span class="hljs-title function_ invoke__">random_range</span>(..=i);
            values.<span class="hljs-title function_ invoke__">swap</span>(i, j);
            progress.<span class="hljs-title function_ invoke__">step</span>();
        }
        writer.<span class="hljs-title function_ invoke__">write_all</span>(&amp;bytes).<span class="hljs-title function_ invoke__">unwrap</span>();
    }
}
</code></pre>
        </details>
        <p>
          Now all we need to do is use this to make a bunch of files with data
          of different sizes. We'll just do all the powers of two up whatever
          fits comfortably on our SSD.
        </p>
        <details>
          <summary>Code for bulk data generation into files.</summary>
          <pre><code class="language-rust"><span class="hljs-keyword">use</span> std::{ops::RangeInclusive, path::Path};

<span class="hljs-keyword">use</span> indicatif::ProgressBar;
<span class="hljs-keyword">use</span> rand::SeedableRng;

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Progress</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ProgressBar</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(len: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-variable">bar</span> = ProgressBar::<span class="hljs-title function_ invoke__">new</span>(len <span class="hljs-keyword">as</span> <span class="hljs-type">u64</span>);
        bar.<span class="hljs-title function_ invoke__">set_position</span>(<span class="hljs-number">0</span>);
        bar
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">step</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">inc</span>(<span class="hljs-number">1</span>);
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_rng</span>(seed: <span class="hljs-type">u64</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Rng</span> {
    rand_pcg::Pcg64Mcg::<span class="hljs-title function_ invoke__">seed_from_u64</span>(seed)
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">generate_file</span>(dir_name: &amp;<span class="hljs-type">str</span>, file_name: &amp;<span class="hljs-type">str</span>, f: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">FnOnce</span>(io::BufWriter&lt;fs::File&gt;)) {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">dir</span> = Path::<span class="hljs-title function_ invoke__">new</span>(dir_name);
    <span class="hljs-keyword">let</span> <span class="hljs-variable">path</span> = dir.<span class="hljs-title function_ invoke__">join</span>(file_name);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;generating {}&quot;</span>, path.<span class="hljs-title function_ invoke__">display</span>());
    fs::<span class="hljs-title function_ invoke__">create_dir_all</span>(dir).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-title function_ invoke__">f</span>(io::BufWriter::<span class="hljs-title function_ invoke__">new</span>(fs::File::<span class="hljs-title function_ invoke__">create</span>(path).<span class="hljs-title function_ invoke__">unwrap</span>()));
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Options</span> {
    <span class="hljs-type">f32</span>: <span class="hljs-type">bool</span>,
    <span class="hljs-type">f64</span>: <span class="hljs-type">bool</span>,
    <span class="hljs-type">u32</span>: <span class="hljs-type">bool</span>,
    <span class="hljs-type">u64</span>: <span class="hljs-type">bool</span>,
}

<span class="hljs-keyword">const</span> FLOAT32: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">&quot;float32&quot;</span>;
<span class="hljs-keyword">const</span> FLOAT64: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">&quot;float64&quot;</span>;
<span class="hljs-keyword">const</span> UNSHUFFLED32: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">&quot;unshuffled32&quot;</span>;
<span class="hljs-keyword">const</span> SHUFFLED32: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">&quot;shuffled32&quot;</span>;
<span class="hljs-keyword">const</span> UNSHUFFLED64: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">&quot;unshuffled64&quot;</span>;
<span class="hljs-keyword">const</span> SHUFFLED64: &amp;<span class="hljs-type">str</span> = <span class="hljs-string">&quot;shuffled64&quot;</span>;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">generate</span>(exponents: RangeInclusive&lt;<span class="hljs-type">usize</span>&gt;, options: Options) {
    <span class="hljs-keyword">for</span> <span class="hljs-variable">exponent</span> <span class="hljs-keyword">in</span> exponents {
        <span class="hljs-keyword">let</span> <span class="hljs-variable">n</span> = <span class="hljs-number">1</span> &lt;&lt; exponent;
        <span class="hljs-keyword">let</span> <span class="hljs-variable">name</span> = <span class="hljs-built_in">format!</span>(<span class="hljs-string">&quot;{exponent}.dat&quot;</span>);
        <span class="hljs-keyword">if</span> options.<span class="hljs-type">f32</span> {
            <span class="hljs-title function_ invoke__">generate_file</span>(FLOAT32, &amp;name, |writer| {
                random_floats::&lt;<span class="hljs-type">f32</span>, ProgressBar&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-title function_ invoke__">make_rng</span>(<span class="hljs-number">0</span>), writer, n);
            });
        }
        <span class="hljs-keyword">if</span> options.<span class="hljs-type">f64</span> {
            <span class="hljs-title function_ invoke__">generate_file</span>(FLOAT64, &amp;name, |writer| {
                random_floats::&lt;<span class="hljs-type">f64</span>, ProgressBar&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-title function_ invoke__">make_rng</span>(<span class="hljs-number">1</span>), writer, n);
            });
        }
        <span class="hljs-keyword">if</span> options.<span class="hljs-type">u32</span> {
            <span class="hljs-title function_ invoke__">generate_file</span>(UNSHUFFLED32, &amp;name, |writer| {
                first_to_last::&lt;<span class="hljs-type">u32</span>, ProgressBar&gt;(writer, n);
            });
            <span class="hljs-title function_ invoke__">generate_file</span>(SHUFFLED32, &amp;name, |writer| {
                permutation::&lt;<span class="hljs-type">u32</span>, ProgressBar&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-title function_ invoke__">make_rng</span>(<span class="hljs-number">2</span>), writer, n);
            });
        }
        <span class="hljs-keyword">if</span> options.<span class="hljs-type">u64</span> {
            <span class="hljs-title function_ invoke__">generate_file</span>(UNSHUFFLED64, &amp;name, |writer| {
                first_to_last::&lt;<span class="hljs-type">u64</span>, ProgressBar&gt;(writer, n);
            });
            <span class="hljs-title function_ invoke__">generate_file</span>(SHUFFLED64, &amp;name, |writer| {
                permutation::&lt;<span class="hljs-type">u64</span>, ProgressBar&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-title function_ invoke__">make_rng</span>(<span class="hljs-number">3</span>), writer, n);
            });
        }
    }
}
</code></pre>
        </details>
        <h2>Results</h2>
        <p>
          Alrighty, now that we have all these files, let's finally run our code
          on them!
        </p>
        <details>
          <summary>Code to calculate sums of our generated data.</summary>
          <pre><code class="language-rust"><span class="hljs-keyword">use</span> std::time::Instant;

<span class="hljs-keyword">use</span> serde::Serialize;

<span class="hljs-meta">#[derive(Serialize)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Measurement</span>&lt;<span class="hljs-symbol">&#x27;a</span>&gt; {
    floats: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-type">str</span>,
    indices: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-type">str</span>,
    exponent: <span class="hljs-type">usize</span>,
    iteration: <span class="hljs-type">usize</span>,
    output: <span class="hljs-type">f64</span>,
    seconds: <span class="hljs-type">f64</span>,
}

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index32</span>(<span class="hljs-type">u32</span>);

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index64</span>(<span class="hljs-type">u64</span>);

<span class="hljs-keyword">impl</span>&lt;T&gt; Index&lt;Index32&gt; <span class="hljs-keyword">for</span> [T] {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span> = T;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">index</span>(&amp;<span class="hljs-keyword">self</span>, index: Index32) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">Self</span>::Output {
        <span class="hljs-keyword">unsafe</span> { <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">get_unchecked</span>(index.<span class="hljs-number">0</span> <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>) }
    }
}

<span class="hljs-keyword">impl</span>&lt;T&gt; Index&lt;Index64&gt; <span class="hljs-keyword">for</span> [T] {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span> = T;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">index</span>(&amp;<span class="hljs-keyword">self</span>, index: Index64) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">Self</span>::Output {
        <span class="hljs-keyword">unsafe</span> { <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">get_unchecked</span>(index.<span class="hljs-number">0</span> <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>) }
    }
}

<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">reinterpret</span>&lt;T&gt;(bytes: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> &amp;[T] {
    <span class="hljs-keyword">let</span> (prefix, values, suffix) = <span class="hljs-keyword">unsafe</span> { bytes.align_to::&lt;T&gt;() };
    <span class="hljs-built_in">assert!</span>(prefix.<span class="hljs-title function_ invoke__">is_empty</span>());
    <span class="hljs-built_in">assert!</span>(suffix.<span class="hljs-title function_ invoke__">is_empty</span>());
    values
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">measure_files</span>&lt;T: Number, I: <span class="hljs-built_in">Copy</span>&gt;(
    dir_floats: &amp;<span class="hljs-type">str</span>,
    dir_indices: &amp;<span class="hljs-type">str</span>,
    exponent: <span class="hljs-type">usize</span>,
    repeat: <span class="hljs-type">usize</span>,
) <span class="hljs-keyword">where</span>
    [T]: Index&lt;I, Output = T&gt;,
{
    <span class="hljs-keyword">let</span> <span class="hljs-variable">name</span> = <span class="hljs-built_in">format!</span>(<span class="hljs-string">&quot;{exponent}.dat&quot;</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-variable">bytes_floats</span> = fs::<span class="hljs-title function_ invoke__">read</span>(Path::<span class="hljs-title function_ invoke__">new</span>(dir_floats).<span class="hljs-title function_ invoke__">join</span>(&amp;name)).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-variable">bytes_indices</span> = fs::<span class="hljs-title function_ invoke__">read</span>(Path::<span class="hljs-title function_ invoke__">new</span>(dir_indices).<span class="hljs-title function_ invoke__">join</span>(&amp;name)).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-variable">floats</span> = <span class="hljs-keyword">unsafe</span> { reinterpret::&lt;T&gt;(&amp;bytes_floats) };
    <span class="hljs-keyword">let</span> <span class="hljs-variable">indices</span> = <span class="hljs-keyword">unsafe</span> { reinterpret::&lt;I&gt;(&amp;bytes_indices) };
    <span class="hljs-keyword">for</span> <span class="hljs-variable">iteration</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..repeat {
        <span class="hljs-keyword">let</span> <span class="hljs-variable">start</span> = Instant::<span class="hljs-title function_ invoke__">now</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-variable">total</span> = <span class="hljs-title function_ invoke__">sum</span>(floats, indices);
        <span class="hljs-keyword">let</span> <span class="hljs-variable">duration</span> = start.<span class="hljs-title function_ invoke__">elapsed</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-variable">measurement</span> = Measurement {
            floats: dir_floats,
            indices: dir_indices,
            exponent,
            iteration,
            output: total.<span class="hljs-title function_ invoke__">into</span>(),
            seconds: duration.<span class="hljs-title function_ invoke__">as_secs_f64</span>(),
        };
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, serde_json::<span class="hljs-title function_ invoke__">to_string</span>(&amp;measurement).<span class="hljs-title function_ invoke__">unwrap</span>());
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">measure</span>(exponents: RangeInclusive&lt;<span class="hljs-type">usize</span>&gt;, options: Options, repeat: <span class="hljs-type">usize</span>) {
    <span class="hljs-keyword">for</span> <span class="hljs-variable">exponent</span> <span class="hljs-keyword">in</span> exponents {
        <span class="hljs-keyword">if</span> options.<span class="hljs-type">f32</span> {
            <span class="hljs-keyword">if</span> options.<span class="hljs-type">u32</span> {
                measure_files::&lt;<span class="hljs-type">f32</span>, Index32&gt;(FLOAT32, UNSHUFFLED32, exponent, repeat);
                measure_files::&lt;<span class="hljs-type">f32</span>, Index32&gt;(FLOAT32, SHUFFLED32, exponent, repeat);
            }
            <span class="hljs-keyword">if</span> options.<span class="hljs-type">u64</span> {
                measure_files::&lt;<span class="hljs-type">f32</span>, Index64&gt;(FLOAT32, UNSHUFFLED64, exponent, repeat);
                measure_files::&lt;<span class="hljs-type">f32</span>, Index64&gt;(FLOAT32, SHUFFLED64, exponent, repeat);
            }
        }
        <span class="hljs-keyword">if</span> options.<span class="hljs-type">f64</span> {
            <span class="hljs-keyword">if</span> options.<span class="hljs-type">u32</span> {
                measure_files::&lt;<span class="hljs-type">f64</span>, Index32&gt;(FLOAT64, UNSHUFFLED32, exponent, repeat);
                measure_files::&lt;<span class="hljs-type">f64</span>, Index32&gt;(FLOAT64, SHUFFLED32, exponent, repeat);
            }
            <span class="hljs-keyword">if</span> options.<span class="hljs-type">u64</span> {
                measure_files::&lt;<span class="hljs-type">f64</span>, Index64&gt;(FLOAT64, UNSHUFFLED64, exponent, repeat);
                measure_files::&lt;<span class="hljs-type">f64</span>, Index64&gt;(FLOAT64, SHUFFLED64, exponent, repeat);
            }
        }
    }
}
</code></pre>
        </details>
        <p>I ran this on two different machines:</p>
        <ul>
          <li>
            A 2020 MacBook Pro with M1 chip, 16 GiB of RAM, and a 1 TB SSD.
          </li>
          <li>
            A Linux desktop with an AMD Ryzen 5 3600X, 24 GiB of Corsair
            Vengeance LPX DDR4 3000MHz DRAM, and a Western Digital 1 TB 3D NAND
            SATA SSD. Unfortunately the RAM is not all exactly the same:
          </li>
        </ul>
        <h3>MacBook</h3>
        <p>
          Here are the results with single-precision floating-point and 32-bit
          integer indices:
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-463.33333333333303 67.5,-739.6491228070175 75,-261.49122807017545 82.5,3.377192982455938 90,108.64035087719294 97.5,140.515350877193 105,144.22149122807025 112.5,156.7790570175439 120,157.1121162280702 127.5,163.3956962719298 135,162.2968064692982 142.5,167.86047149122805 150,168.06392201206143 157.5,171.3712136787281 165,173.61912777549344 172.5,175.74716668379938 180,176.4213160464638 187.5,176.76449424342104 195,177.60931316174958 202.5,177.89829120301363 210,177.97992338214004 217.5,177.61805233202483 225,142.5469608474196 232.5,105.53633121022007 240,91.19137105188872 247.5,78.85666497966699 255,71.65691907991439 262.5,67.87751186312286 270,61.088409383307464 277.5,54.236034050976 285,50.98473441215208"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-550.3508771929824 67.5,-148.77192982456137 75,-279.9122807017545 82.5,11.052631578947256 90,115.78947368421046 97.5,138.87061403508775 105,147.41228070175447 112.5,156.31304824561408 120,158.03042763157896 127.5,163.51493969298247 135,163.68558114035085 142.5,167.97594572368416 150,168.06375068530707 157.5,170.8804910224781 165,173.73849969161188 172.5,176.41546952097045 180,176.2182831345943 187.5,177.0770397520902 195,177.49454029819424 202.5,177.90776972185103 210,177.64316793073687 217.5,177.71639572946648 225,178.00930198870208 232.5,178.11539959489255 240,178.25321371095225 247.5,178.19796442985535 255,177.99864640884232 262.5,178.0036489377942 270,178.07229008983103 277.5,178.08454865426347 285,178.59320045791958"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>Here's single-precision with 64-bit indices; basically the same:</p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-493.5087719298243 67.5,-689.2982456140357 75,-210.35087719298258 82.5,-12.675438596491347 90,107.69736842105259 97.5,162.10526315789468 105,144.6765350877194 112.5,154.82730263157896 120,157.34100877192986 127.5,163.2517817982456 135,167.78371710526318 142.5,167.83939830043855 150,170.13080797697373 157.5,170.64298930921058 165,176.08362030564695 172.5,175.9978605571546 180,176.36084305612664 187.5,177.0483666135554 195,177.67300923665363 202.5,177.84968794437876 210,177.92832290917113 217.5,176.92643617328847 225,134.09940719604492 232.5,102.91971030988189 240,89.50224704909743 247.5,76.4214244118908 255,70.33833082307851 262.5,66.07959405633446 270,60.19664622581843 277.5,52.346034516629516"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-519.8245614035085 67.5,-712.1052631578948 75,-229.03508771929836 82.5,-18.640350877193043 90,113.94736842105253 97.5,162.47807017543855 105,144.6655701754387 112.5,156.65021929824564 120,157.34375 127.5,163.37171052631578 135,162.9430509868421 142.5,167.88188733552627 150,171.33386444627197 157.5,171.360505756579 165,173.7135288171601 172.5,175.85740474232458 180,175.896858081483 187.5,177.22849795692846 195,177.52889532791943 202.5,177.8413752505654 210,177.86082686039438 217.5,178.1032890185975 225,178.12322348879096 232.5,178.17354403044047 240,178.1849315291957 247.5,178.08535777685933 255,177.9559013874907 262.5,177.99196579477243 270,178.07474882325585 277.5,178.07121968386988"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          Now here's double-precision floating-point and 32-bit integer indices:
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-462.631578947368 67.5,-777.8947368421054 75,-203.5087719298246 82.5,27.45614035087698 90,111.35964912280696 97.5,161.15131578947367 105,143.07565789473693 112.5,155.1809210526316 120,160.999177631579 127.5,163.63075657894734 135,164.57134046052636 142.5,167.98948053728066 150,171.35844983552636 157.5,173.83035224780707 165,176.31379780016448 172.5,176.19863409745065 180,176.31046228241502 187.5,177.0738006056401 195,177.57969371059485 202.5,177.98133381626062 210,177.48887948822556 217.5,138.34667674282142 225,103.51069743173161 232.5,84.22482846076022 240,77.15293162747435 247.5,70.69034415378906 255,67.62575131759306 262.5,61.3383993454147 270,53.95962556333919 277.5,50.01215953249158"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-418.4210526315785 67.5,-725.6140350877192 75,-173.50877192982506 82.5,16.18421052631561 90,114.03508771929819 97.5,166.09649122807014 105,146.48574561403515 112.5,155.42489035087723 120,157.859100877193 127.5,159.11869517543863 135,167.8262061403509 142.5,167.92506167763153 150,169.28856565241233 157.5,173.28968784265354 165,176.41901384320175 172.5,175.7039280941612 180,176.08309026350054 187.5,176.95770799067984 195,177.6369235390111 202.5,177.84890559681676 210,177.71463762249863 217.5,178.0780464306212 225,177.2102925651952 232.5,178.12082696379275 240,178.20468724819654 247.5,177.9685261688734 255,177.93300260054437 262.5,177.97849112173967 270,178.05966738676815 277.5,178.07321094695413"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>And finally, here's double-precision and 64-bit indices:</p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-447.1929824561398 67.5,-813.8596491228071 75,-181.49122807017574 82.5,38.20175438596465 90,111.4473684210526 97.5,134.671052631579 105,152.8837719298246 112.5,155.62500000000003 120,163.05235745614038 127.5,162.07922149122808 135,167.65385142543857 142.5,167.8616707785087 150,170.259217379386 157.5,173.76070792214915 165,176.2663617050439 172.5,175.6328917386239 180,176.49917334841007 187.5,177.07871821888708 195,177.4995101125617 202.5,176.64978830437911 210,176.30845889710542 217.5,134.90470819305955 225,102.40160088790093 232.5,86.63402866898923 240,75.88540568686366 247.5,69.71630535627676 255,66.71073131916825 262.5,60.10566887364055 270,52.57011756693066 277.5,47.73948515781706"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-464.3859649122803 67.5,-718.9473684210526 75,-203.1578947368422 82.5,39.9122807017541 90,114.10087719298237 97.5,155.66885964912277 105,154.27083333333334 112.5,155.3837719298246 120,163.27713815789474 127.5,163.5971765350877 135,167.81318530701756 142.5,167.95418722587715 150,170.75195312500003 157.5,173.821443256579 165,176.33155153508773 172.5,175.65970437568532 180,176.19977449115953 187.5,176.99683741519326 195,177.65627409282484 202.5,177.25706870095772 210,177.83087847525613 217.5,177.46509401421798 225,178.20905417726752 232.5,178.26438698852272 240,178.00878669086256 247.5,177.8729299913373 255,177.93978961413364 262.5,178.00181864646441 270,178.04623368408596 277.5,178.00294004838196"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>Neat!</p>
        <h3>Linux desktop</h3>
        <p>
          Here are the results with single-precision floating-point and 32-bit
          integer indices:
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-626.4912280701749 67.5,-206.66666666666652 75,-7.0175438596490665 82.5,94.38596491228061 90,142.34649122807014 97.5,120.25219298245612 105,135.6359649122806 112.5,161.02796052631572 120,158.5416666666667 127.5,161.74479166666669 135,161.05365953947367 142.5,186.13264117324562 150,186.79747464364036 157.5,186.43233449835526 165,168.66515042489036 172.5,183.68748715049338 180,185.38764819764253 187.5,184.1778216445655 195,182.34817504882812 202.5,184.61331083063493 210,184.32471827456826 217.5,153.2485071818034 225,62.175136449044174 232.5,40.49929635566579 240,19.55372316795487 247.5,6.232538672915666 255,-7.228079323183067 262.5,-24.275387509873212 270,-43.25774879962731 277.5,-123.9783097842805 285,-527.3611761649187"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-629.6491228070178 67.5,-206.49122807017534 75,5.08771929824573 82.5,93.55263157894733 90,152.25877192982458 97.5,155.7017543859649 105,146.6063596491228 112.5,155.44682017543863 120,159.9698464912281 127.5,161.71121162280704 135,186.08689692982458 142.5,186.15577028508773 150,186.5552186129386 157.5,186.62409196820175 165,168.5324364377741 172.5,186.16879111842107 180,186.57604016755758 187.5,186.34280556126646 195,186.35885405958743 202.5,186.56887522914954 210,186.28452234100877 217.5,182.09859513399894 225,184.57450063605057 232.5,183.87520526584825 240,183.26706706431875 247.5,183.24742577577894 255,183.5608491406106 262.5,183.66147172555588 270,183.78902368770358 277.5,183.96534685176192 285,183.8392681899693"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>Here's single-precision with 64-bit indices; basically the same:</p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-577.7192982456135 67.5,-196.14035087719282 75,-1.6666666666666572 82.5,105.52631578947373 90,140.94298245614027 97.5,123.38815789473684 105,174.3804824561403 112.5,150.6825657894737 120,156.58580043859652 127.5,160.73670504385967 135,184.16700932017545 142.5,185.510039747807 150,185.6104372258772 157.5,186.46818462171055 165,169.11860951206143 172.5,182.2290253220943 180,185.84553501062226 187.5,184.41697505482455 195,181.41190645987527 202.5,183.00704889130174 210,174.44121009425115 217.5,122.0087452938682 225,61.22844085358736 232.5,34.77861939815054 240,14.943807459714122 247.5,-3.670337377933123 255,-17.120439237669956 262.5,-31.182275461523204 270,-46.448926137466174 277.5,-132.11516104246442 285,-553.2367424222462"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-599.1228070175434 67.5,-197.71929824561386 75,-10.61403508771923 82.5,94.03508771929829 90,139.32017543859644 97.5,115.17543859649123 105,137.82346491228068 112.5,151.5076754385965 120,146.77357456140356 127.5,161.23697916666669 135,160.18914473684208 142.5,185.5994723135965 150,186.80646929824562 157.5,186.38534813596493 165,168.7584806743421 172.5,186.2218167489035 180,186.51805676912005 187.5,186.5894063313802 195,186.46554511890076 202.5,186.3144984998201 210,184.14709225035548 217.5,175.66746477495158 225,176.09216832278065 232.5,177.13406847234359 240,177.5287580071834 247.5,177.67443442553807 255,178.30587198859766 262.5,178.1065135174676 270,178.20350504627353 277.5,178.7221470279129 285,178.91430087550953"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>
          Now here's double-precision floating-point and 32-bit integer indices:
        </p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-613.5087719298238 67.5,-181.5789473684207 75,-2.1929824561402143 82.5,107.54385964912285 90,138.85964912280696 97.5,115.15350877192975 105,137.1710526315789 112.5,155.30427631578954 120,156.40076754385967 127.5,159.71765350877195 135,185.71100603070178 142.5,186.04817708333331 150,170.44741981907896 157.5,186.450409470943 165,184.99205472176536 172.5,182.656035841557 180,186.3080851236979 187.5,183.81726716694078 195,181.76462273848685 202.5,183.3445532280102 210,149.73556819715 217.5,43.677055459273504 225,34.59541253876259 232.5,18.006335894266783 240,3.869382331245845 247.5,-8.53850334359879 255,-24.58665570146158 262.5,-44.500644562537246 270,-121.59992539961075 277.5,-524.9224586595305 285,-1121.7155795145713"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-631.403508771929 67.5,-167.36842105263145 75,0.964912280701725 82.5,110.30701754385974 90,144.14473684210523 97.5,123.11403508771927 105,135.3837719298245 112.5,151.48574561403515 120,157.77138157894734 127.5,158.94805372807016 135,185.2114172149123 142.5,184.94192023026318 150,186.60070586622805 157.5,185.48999451754386 165,186.21057343064695 172.5,186.10291598135964 180,186.66953103584154 187.5,186.64082041957923 195,186.3570537901761 202.5,186.1663135729338 210,184.461894118995 217.5,178.8800743169952 225,180.57956260547303 232.5,180.46385505743194 240,181.21050939225313 247.5,181.8068399450235 255,182.22113559643427 262.5,182.6570277726441 270,182.88708603695818 277.5,182.9710839701849 285,182.81079081589715"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>And finally, here's double-precision and 64-bit indices:</p>
        <div class="svg">
          <svg viewBox="0 0 300 250" height="250">
            <polyline
              points="60,-642.6315789473676 67.5,-195.61403508771906 75,10.877192982456165 82.5,111.14035087719296 90,141.84210526315786 97.5,130.14254385964904 105,133.29495614035085 112.5,155.31250000000006 120,157.44928728070175 127.5,159.7060032894737 135,185.8569764254386 142.5,185.48057154605263 150,186.08064350328945 157.5,185.8938116776316 165,185.1841334292763 172.5,185.1781584087171 180,182.57851583915843 187.5,179.69736199629935 195,185.24298684638845 202.5,181.85119361208194 210,117.69834150347798 217.5,34.31589963143338 225,20.586279484263713 232.5,13.880624854773771 240,-7.863541339573231 247.5,-17.35401729742682 255,-32.589560454351926 262.5,-47.426503407850646 270,-134.4934782974031 277.5,-555.2359241502064 285,-1137.4017879857051"
              fill="none"
              stroke="hsl(0 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <polyline
              points="60,-707.1929824561406 67.5,-188.5964912280698 75,14.12280701754392 82.5,111.88596491228076 90,141.62280701754378 97.5,127.62061403508768 105,136.25548245614027 112.5,151.875 120,158.15515350877195 127.5,160.1795504385965 135,186.08107182017545 142.5,186.0656524122807 150,178.42739172149126 157.5,186.47143983004386 165,185.9974429481908 172.5,186.05659351014253 180,186.57937033134596 187.5,186.44737377501372 195,185.98726640667832 202.5,185.5653782894737 210,175.2820690891199 217.5,171.89004964995803 225,172.7576998660439 232.5,171.68625672658285 240,170.81041428080778 247.5,172.7251598709508 255,172.5132378935814 262.5,172.9193834699037 270,173.00762445910982 277.5,173.36163048354678 285,170.51202658563852"
              fill="none"
              stroke="hsl(222 100% 75%)"
              stroke-width="2"
              stroke-linejoin="round"
            ></polyline>
            <text
              x="0"
              y="105"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
              transform="rotate(-90 0 105)"
            >
              time per element
            </text>
            <text
              x="55"
              y="10"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              6ns
            </text>
            <text
              x="55"
              y="43.33333333333333"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              5ns
            </text>
            <text
              x="55"
              y="76.66666666666669"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              4ns
            </text>
            <text
              x="55"
              y="110"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              3ns
            </text>
            <text
              x="55"
              y="143.33333333333337"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              2ns
            </text>
            <text
              x="55"
              y="176.66666666666666"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              1ns
            </text>
            <text
              x="55"
              y="210"
              fill="white"
              text-anchor="end"
              dominant-baseline="central"
            >
              0ns
            </text>
            <text
              x="90"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              4
            </text>
            <text
              x="120"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              8
            </text>
            <text
              x="150"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              12
            </text>
            <text
              x="180"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              16
            </text>
            <text
              x="210"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              20
            </text>
            <text
              x="240"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              24
            </text>
            <text
              x="270"
              y="215"
              fill="white"
              text-anchor="middle"
              dominant-baseline="hanging"
            >
              28
            </text>
            <text
              x="172.5"
              y="245"
              fill="white"
              text-anchor="middle"
              dominant-baseline="text-bottom"
            >
              logarithm of array length
            </text>
            <polyline
              points="60,10 60,210 285,210"
              fill="none"
              stroke="white"
              stroke-width="2"
            ></polyline>
          </svg>
        </div>
        <p>Again, neat!</p>
      </div>
    </main>
  </body>
</html>
